From ad032d5ef4e7bc20f6d283f535bfb94825261961 Mon Sep 17 00:00:00 2001
From: Vijai Kumar K <vijaikumar.kanagarajan@gmail.com>
Date: Thu, 12 Dec 2019 12:57:19 +0530
Subject: [PATCH] jailhouse-patches

Signed-off-by: Vijai Kumar K <vijaikumar.kanagarajan@gmail.com>
---
 arch/arm/kernel/armksyms.c   | 5 +++++
 arch/arm/kernel/hyp-stub.S   | 2 ++
 arch/arm64/kernel/hyp-stub.S | 2 ++
 lib/ioremap.c                | 1 +
 4 files changed, 10 insertions(+)

diff --git a/arch/arm/kernel/armksyms.c b/arch/arm/kernel/armksyms.c
index 98bdea51089d..f2fa635bccf7 100644
--- a/arch/arm/kernel/armksyms.c
+++ b/arch/arm/kernel/armksyms.c
@@ -17,6 +17,7 @@
 
 #include <asm/checksum.h>
 #include <asm/ftrace.h>
+#include <asm/virt.h>
 
 /*
  * libgcc functions - functions that are used internally by the
@@ -176,3 +177,7 @@ EXPORT_SYMBOL(__pv_offset);
 EXPORT_SYMBOL(__arm_smccc_smc);
 EXPORT_SYMBOL(__arm_smccc_hvc);
 #endif
+
+#ifdef CONFIG_ARM_VIRT_EXT
+EXPORT_SYMBOL_GPL(__boot_cpu_mode);
+#endif
diff --git a/arch/arm/kernel/hyp-stub.S b/arch/arm/kernel/hyp-stub.S
index ae5020302de4..5fd35233d5b6 100644
--- a/arch/arm/kernel/hyp-stub.S
+++ b/arch/arm/kernel/hyp-stub.S
@@ -7,6 +7,7 @@
 #include <linux/irqchip/arm-gic-v3.h>
 #include <linux/linkage.h>
 #include <asm/assembler.h>
+#include <asm-generic/export.h>
 #include <asm/virt.h>
 
 #ifndef ZIMAGE
@@ -269,4 +270,5 @@ __hyp_stub_trap:	W(b)	__hyp_stub_do_trap
 __hyp_stub_irq:		W(b)	.
 __hyp_stub_fiq:		W(b)	.
 ENDPROC(__hyp_stub_vectors)
+EXPORT_SYMBOL_GPL(__hyp_stub_vectors)
 
diff --git a/arch/arm64/kernel/hyp-stub.S b/arch/arm64/kernel/hyp-stub.S
index 73d46070b315..3a99c82c0e94 100644
--- a/arch/arm64/kernel/hyp-stub.S
+++ b/arch/arm64/kernel/hyp-stub.S
@@ -9,6 +9,7 @@
 #include <linux/init.h>
 #include <linux/linkage.h>
 #include <linux/irqchip/arm-gic-v3.h>
+#include <asm-generic/export.h>
 
 #include <asm/assembler.h>
 #include <asm/kvm_arm.h>
@@ -42,6 +43,7 @@ ENTRY(__hyp_stub_vectors)
 	ventry	el1_fiq_invalid			// FIQ 32-bit EL1
 	ventry	el1_error_invalid		// Error 32-bit EL1
 ENDPROC(__hyp_stub_vectors)
+EXPORT_SYMBOL_GPL(__hyp_stub_vectors)
 
 	.align 11
 
diff --git a/lib/ioremap.c b/lib/ioremap.c
index 0a2ffadc6d71..baefdda8f32c 100644
--- a/lib/ioremap.c
+++ b/lib/ioremap.c
@@ -231,3 +231,4 @@ int ioremap_page_range(unsigned long addr,
 
 	return err;
 }
+EXPORT_SYMBOL_GPL(ioremap_page_range);
-- 
2.17.1

